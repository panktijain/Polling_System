{% extends "polls/base.html" %}
{% block title %}{{ poll.question }}{% endblock %}
{% block content %}
<a href="{% url 'poll_list' %}" class="back-link">‚Üê Back to polls</a>

<div class="page-header">
    <h1>{{ poll.question }}</h1>
</div>

{% if already_voted %}
<div class="alert alert-info">
    You voted for <strong>{{ user_vote.option.text }}</strong>.
    <a href="{% url 'poll_results' poll.id %}">View results &rarr;</a>
</div>
{% elif not user.is_authenticated %}
<div class="alert alert-info">
    <a href="{% url 'login' %}?next={{ request.path }}">Log in</a> to vote on this poll.
</div>
{% endif %}

{% if error %}
<div class="alert alert-error">{{ error }}</div>
{% endif %}

{% if poll.options.all %}
{% if not already_voted and user.is_authenticated %}
<form method="post" action="{% url 'vote' poll.id %}" style="margin-top:16px;">
    {% csrf_token %}
    <div class="card" style="margin-top:0;">
        {% for option in poll.options.all %}
        <label class="option-label">
            <input type="radio" name="option" value="{{ option.id }}">
            {{ option.text }}
        </label>
        {% endfor %}
    </div>
    <button type="submit" class="btn">Submit Vote</button>
</form>
{% elif not user.is_authenticated %}
<div class="card" style="opacity:.6;">
    {% for option in poll.options.all %}
    <label class="option-label" style="cursor:default;">
        <input type="radio" name="option" value="{{ option.id }}" disabled>
        {{ option.text }}
    </label>
    {% endfor %}
</div>
{% endif %}
{% else %}
<div class="card">
    <p>No options available for this poll.</p>
</div>
{% endif %}

{% if user == poll.created_by %}
<div class="card danger-zone" style="margin-top:24px;">
    <h2>Manage Poll</h2>
    <div class="btn-group">
        <form method="post" action="{% url 'deactivate_poll' poll.id %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-secondary btn-sm">
                {% if poll.is_active %}Deactivate{% else %}Reactivate{% endif %}
            </button>
        </form>
        <a href="{% url 'delete_poll' poll.id %}" class="btn btn-danger btn-sm">Delete Poll</a>
    </div>
</div>
{% endif %}
{% endblock %}